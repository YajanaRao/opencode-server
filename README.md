# OpenCode Web Server

Deploy OpenCode as a password-protected web interface on Render.com.

## ðŸŽ¯ Overview

This project deploys [OpenCode](https://opencode.ai) as an always-accessible web interface, allowing you to interact with AI coding assistants (ChatGPT, Claude, etc.) through your browser.

**Features:**

- ðŸ”’ Password-protected access
- ðŸŒ Web-based interface (no terminal required)
- â˜ï¸ Hosted on Render.com (free tier)
- ðŸš€ Auto-deploy from GitHub
- ðŸ” Secure environment variable management

## ðŸ“‹ Prerequisites

- GitHub account
- Render.com account (free)
- LLM provider API key (OpenAI, Anthropic, or OpenCode Zen)

## ðŸš€ Quick Start

### 1. Create GitHub Repository

```bash
cd ~/Developer/opencode-server

# Initialize git
git init
git add .
git commit -m "Initial OpenCode server setup"

# Create repository on GitHub (replace with your username)
# GitHub > New Repository > opencode-server (Private recommended)

# Push to GitHub
git remote add origin https://github.com/YajanaRao/opencode-server.git
git branch -M main
git push -u origin main
```

### 2. Deploy to Render

**Option A: Via Render Dashboard (Recommended)**

1. Go to [Render Dashboard](https://dashboard.render.com)
2. Click **"New"** â†’ **"Web Service"**
3. Click **"Connect GitHub"** and authorize Render
4. Select **`opencode-server`** repository
5. Render will detect `render.yaml` automatically
6. Click **"Apply"** to use the configuration
7. Review settings and click **"Create Web Service"**

**Option B: Via Render CLI**

```bash
# Install Render CLI
npm install -g render-cli

# Login to Render
render login

# Deploy
render deploy
```

### 3. Get Your Password

After deployment completes:

1. Go to your service in Render Dashboard
2. Click **"Environment"** tab
3. Find `OPENCODE_SERVER_PASSWORD`
4. Click **"Show"** to reveal the password
5. **Save this password securely!**

### 4. Access OpenCode Web

Your OpenCode instance will be available at:

```
URL: https://opencode-web-xxxx.onrender.com
Username: admin
Password: [from Render Environment variables]
```

**Note:** First access may take 50 seconds (cold start on free tier).

## âš™ï¸ Configuration

### Environment Variables

Set these in Render Dashboard > Environment tab:

| Variable                   | Description      | Default                  |
| -------------------------- | ---------------- | ------------------------ |
| `OPENCODE_SERVER_PASSWORD` | Access password  | Auto-generated by Render |
| `OPENCODE_SERVER_USERNAME` | Access username  | `admin`                  |
| `NODE_ENV`                 | Environment mode | `production`             |

### LLM Provider Setup

After deployment, you need to configure an LLM provider:

1. Access your OpenCode web interface
2. Run command: `/connect`
3. Choose your provider:
   - **OpenCode Zen** (recommended for beginners)
   - **OpenAI** (ChatGPT)
   - **Anthropic** (Claude)
   - Other providers

**For OpenCode Zen:**

```
1. Select "opencode" from the provider list
2. Visit https://opencode.ai/auth
3. Sign in and add billing details
4. Copy your API key
5. Paste into OpenCode
```

**For OpenAI:**

```
1. Add environment variable: OPENAI_API_KEY
2. Get key from: https://platform.openai.com/api-keys
```

**For Anthropic:**

```
1. Add environment variable: ANTHROPIC_API_KEY
2. Get key from: https://console.anthropic.com/settings/keys
```

## ðŸ“Š Resource Usage

**Render Free Tier:**

- CPU: 0.1 shared CPU
- RAM: 512MB
- Storage: Ephemeral (resets on restart)
- Bandwidth: 100GB/month

**Expected Usage:**

- Idle: ~100MB RAM, <5% CPU
- Active: ~250MB RAM, 20-30% CPU
- Peak: ~300MB RAM, 50% CPU (brief spikes)

**Limitations:**

- âš ï¸ Sleeps after 15 minutes of inactivity
- âš ï¸ 50-second cold start after sleep
- âš ï¸ Sessions lost on restart (ephemeral storage)

## ðŸ”§ Local Development

To test locally before deploying:

```bash
# Install Docker Desktop (if not installed)

# Build the Docker image
docker build -t opencode-web .

# Run locally
docker run -p 4096:4096 \
  -e OPENCODE_SERVER_PASSWORD=test123 \
  -e OPENCODE_SERVER_USERNAME=admin \
  opencode-web

# Access at http://localhost:4096
```

## ðŸ”„ Updating

To update your deployment:

```bash
# Make changes to Dockerfile or render.yaml
git add .
git commit -m "Update configuration"
git push

# Render auto-deploys (if autoDeploy: true in render.yaml)
```

## ðŸ” Security Best Practices

1. âœ… Keep GitHub repository **private**
2. âœ… Use auto-generated strong password
3. âœ… Don't commit `.env` files
4. âœ… Rotate password periodically (Render Dashboard > Environment)
5. âœ… Don't share password publicly
6. âš ï¸ Consider restricting CORS from `*` to specific domains

### Restrict CORS (Optional)

Edit `Dockerfile`, change the CMD line:

```dockerfile
# Before (allows all origins)
CMD ["sh", "-c", "opencode web --hostname 0.0.0.0 --port 4096 --cors '*'"]

# After (specific domain only)
CMD ["sh", "-c", "opencode web --hostname 0.0.0.0 --port 4096 --cors 'https://yourdomain.com'"]
```

## ðŸ§ª Testing

After deployment, verify everything works:

### 1. Health Check

```bash
curl https://opencode-web-xxxx.onrender.com/global/health
# Expected: {"healthy":true,"version":"..."}
```

### 2. Web Access

1. Open URL in browser
2. Login with username/password
3. Should see OpenCode homepage

### 3. Test Session

1. Click "New Session"
2. Enter prompt: "What is 2+2?"
3. Should get response from LLM

## ðŸ“ˆ Monitoring

### View Logs

**Via Render Dashboard:**

1. Go to your service
2. Click **"Logs"** tab
3. View real-time logs

**Via Render CLI:**

```bash
render logs opencode-web
```

### Check Metrics

Render Dashboard > Metrics tab shows:

- CPU usage
- Memory usage
- Request count
- Response times

## ðŸ› Troubleshooting

### Service Won't Start

**Problem:** Deployment fails or service crashes

**Solutions:**

1. Check logs in Render Dashboard
2. Verify Dockerfile syntax: `docker build -t test .`
3. Check environment variables are set
4. Verify port 4096 is exposed

### Can't Access Web Interface

**Problem:** URL returns 404 or connection refused

**Solutions:**

1. Wait 50 seconds for cold start (free tier)
2. Check service status in Render Dashboard
3. Verify URL is correct (ends with .onrender.com)
4. Check health check endpoint: `/global/health`

### Authentication Not Working

**Problem:** Wrong username/password

**Solutions:**

1. Verify password in Render Dashboard > Environment
2. Username should be `admin` (check env vars)
3. Try regenerating password (Render Dashboard)
4. Clear browser cache/cookies

### Out of Memory

**Problem:** Service crashes with memory errors

**Solutions:**

1. Check metrics (Render Dashboard > Metrics)
2. Free tier has 512MB limit
3. Consider upgrading to Starter plan ($7/month, 512MB, 0.5 CPU)
4. Or optimize usage (close unused sessions)

## ðŸ”® Future Enhancements

After initial deployment works, consider:

### Phase 2: GitHub Integration

- Add `GITHUB_TOKEN` environment variable
- Configure OpenCode to access repositories
- Test cloning and modifying repos

### Phase 3: Notes Repository

- Create separate `Notes` repository
- Add note-taking workflows
- Configure auto-save to Notes repo

### Phase 4: Always-On Setup

- Add keep-alive service (prevent sleep)
- Use cron-job.org to ping every 14 minutes
- Or upgrade to paid plan ($7/month)

### Phase 5: Advanced Configuration

- Restrict CORS to specific domains
- Add persistent storage (volume or external DB)
- Set up monitoring alerts
- Configure custom domain

## ðŸ“š Resources

- [OpenCode Documentation](https://opencode.ai/docs)
- [OpenCode Web Guide](https://opencode.ai/docs/web/)
- [Render Documentation](https://render.com/docs)
- [Docker Documentation](https://docs.docker.com)

## ðŸ†˜ Support

- OpenCode Discord: https://opencode.ai/discord
- Render Community: https://community.render.com
- GitHub Issues: https://github.com/YajanaRao/opencode-server/issues

## ðŸ“„ License

This deployment configuration is provided as-is for personal use.

OpenCode is developed by [Anomaly](https://anoma.ly).

---

**Created by:** Yajana Rao  
**Last Updated:** Feb 2, 2025
